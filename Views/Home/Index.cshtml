@{
    ViewData["Title"] = "WebSSH终端";
}

<div class="webssh-container">
    <div class="terminal-container">
        <div id="terminal"></div>
    </div>
</div>

@section scripts {
    <link rel="stylesheet" href="~/lib/xterm/xterm/css/xterm.css" asp-append-version="true" />
    <script src="~/lib/xterm/xterm/lib/xterm.js" asp-append-version="true"></script>
    <script src="~/lib/xterm/addon-fit/lib/addon-fit.js" asp-append-version="true"></script>
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.js" asp-append-version="true"></script>
    <script src="~/js/terminal.js" asp-append-version="true"></script>
    <script>
        const terminalContainer = document.getElementById('terminal-container');
        const term = new Terminal({
            fontSize: 14,
            lineHeight: 1.2,
            theme: {
                background: '#000'
            }
        });

        // 创建 FitAddon 实例
        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        
        term.open(terminalContainer);
        
        // 初始适配
        fitAddon.fit();

        // 监听窗口大小变化
        window.addEventListener('resize', () => {
            fitAddon.fit();
        });

        // 语言和主题状态
        let currentLanguage = localStorage.getItem('appLanguage') || 'zh-CN';
        let isDarkTheme = localStorage.getItem('isDarkTheme') !== 'false';

        // 初始化主题
        if (!isDarkTheme) {
            term.setOption('theme', { 
                background: '#fff', 
                foreground: '#000',
                cursor: '#000'
            });
            document.body.classList.add('light-theme');
        }
    </script>
}